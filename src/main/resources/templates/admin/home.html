<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head th:replace="common/simple_css :: head"></head>

<!--adminLTE相关css-->
<!--<link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap-datetimepicker.css}" />-->
<!-- Font Awesome -->
<link rel="stylesheet" th:href="@{/bootstrap/adminLTE/bower_components/font-awesome/css/font-awesome.min.css}"/>
<!-- Ionicons -->
<link rel="stylesheet" th:href="@{/bootstrap/adminLTE/bower_components/Ionicons/css/ionicons.min.css}"/>
<!-- jvectormap -->
<!--<link rel="stylesheet" th:href="@{/bootstrap/adminLTE/bower_components/jvectormap/jquery-jvectormap.css}"/>-->
<!-- Theme style -->
<link rel="stylesheet" th:href="@{/bootstrap/adminLTE/dists/css/AdminLTE.min.css}"/>
<!-- AdminLTE Skins. Choose a skin from the css/skins
     folder instead of downloading all of them to reduce the load. -->
<link rel="stylesheet" th:href="@{/bootstrap/adminLTE/dists/css/skins/_all-skins.min.css}"/>
<!--日历插件-->
<link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap-datepicker3.css}"/>

<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Title</title>
</head>
<body class="hold-transition skin-blue sidebar-mini" style="overflow: scroll;overflow-y: hidden">
<div class="wrapper" style="margin-top: 10px">

    <div class="content-wrapper" style="margin-left: 0px">

        <!-- -------------------一行显示----------------------->


        <!----------------------一行显示-------------------- -->
        <div class="row" style="margin-left: 3px;margin-right: 3px">
            <!-- Left col -->
            <section class="col-sm-9 connectedSortable ui-sortable" style="margin-top: 3px">
                <div class="row">

                    <div class="col-sm-4 ">
                        <div class="info-box">
                            <span class="info-box-icon bg-aqua"><i class="ion ion-laptop"></i></span>

                            <div class="info-box-content">
                                <span class="info-box-text">待审批工单</span>
                                <span class="info-box-number">&nbsp;&nbsp;&nbsp;&nbsp;<span th:text="${totalApply}"></span></span>
                                <a href="/todo/page" class="small-box-footer">查看详情 <i class="fa fa-arrow-circle-right"></i></a>
                            </div>
                            <!-- /.info-box-content -->
                        </div>
                        <!-- /.info-box -->
                    </div>
                    <!-- /.col -->
                    <div class=" col-sm-4">
                        <div class="info-box">
                            <span class="info-box-icon bg-red"><i class="ion ion-jet"></i></span>

                            <div class="info-box-content">
                                <span class="info-box-text">进行中活动</span>
                                <span class="info-box-number">&nbsp;&nbsp;&nbsp;&nbsp;<span th:text="${actCount}"></span></span>
                                <a href="/actmanager/page" class="small-box-footer ">查看详情 <i class="fa fa-arrow-circle-right"></i></a>
                            </div>
                            <!-- /.info-box-content -->
                        </div>
                        <!-- /.info-box -->
                    </div>
                    <!-- /.col -->

                    <!-- fix for small devices only -->
                    <div class="clearfix visible-sm-block"></div>

                    <div class="col-sm-4">
                        <div class="info-box">
                            <span class="info-box-icon bg-green"><i class="ion ion-iphone"></i></span>

                            <div class="info-box-content">
                                <span class="info-box-text">进行活动广告位</span>
                                <span class="info-box-number">&nbsp;&nbsp;&nbsp;&nbsp;<span th:text="${adplaceData.ad}"></span></span>
                                <a href="//schedule/page" class="small-box-footer ">查看详情 <i class="fa fa-arrow-circle-right"></i></a>
                            </div>
                            <!-- /.info-box-content -->
                        </div>
                        <!-- /.info-box -->
                    </div>
                    <!-- /.col -->
                </div>
                <!-- 活动数据统计表-->
                <div class="box box-solid">
                    <div id="actLine" style="height: 445px"></div>
                </div>
            </section>


            <!-- /.Left col -->
            <!-- right col (We are only adding the ID to make the widgets sortable)-->
            <section class="col-sm-3 connectedSortable ui-sortable">

                <!-- solid sales graph -->
                <div class="box box-solid " style="height: 330px">
                    <div class="box-header ui-sortable-handle" style="cursor: move;">
                        <div id="cal">
                            <!--<div id="cal"></div>-->
                            <!-- /.box-footer -->
                        </div>
                    </div>
                    <!-- /.box -->


                    <!-- Calendar -->
                    <div class="box box-solid ">
                        <div class="box-header ui-sortable-handle" style="cursor: move;">
                            <i class="fa fa-calendar"></i>

                            <h3 class="box-title">当日进行中活动！</h3>
                            <!-- tools box -->
                            <div class="pull-right box-tools">
                                <!-- button with a dropdown -->
                                <button type="button" class="btn btn-success btn-sm" data-widget="collapse"><i class="fa fa-minus"></i>
                                </button>
                                <!-- <button type="button" class="btn btn-success btn-sm" data-widget="remove"><i class="fa fa-times"></i>
                                 </button>-->
                            </div>
                            <!-- /. tools -->
                        </div>
                        <!-- /.box-header -->
                        <div class="box-body no-padding">
                            <!--日历 -->

                        </div>
                        <!-- /.box-body -->
                        <div class="box-footer text-black">
                            <div class="row" style="height:190px; overflow:hidden;overflow-y: scroll;" id="currentacts">
                                <div class="col-sm-12 currentact" th:each="act:${todayActs}">
                                    <!-- Progress bars -->
                                    <div class="clearfix ">
                                        <span class="pull-left" th:text="${act.name+' '}"></span>(<span
                                            th:text="${#dates.format(act.beginTime, 'yyyy-MM-dd')+'至'+ #dates.format(act.endTime, 'yyyy-MM-dd')}"></span>)
                                        <small class="pull-right">进度<span th:text='${act.percent}'></span>%</small>
                                    </div>
                                    <div class="progress xs ">
                                        <div class="progress-bar  progress-bar-green " th:style="'width:'+${act.percent+'%'}"></div>
                                    </div>
                                </div>
                                <!-- /.col -->
                            </div>
                            <!-- /.row -->
                        </div>
                    </div>
                    <!-- /.box -->
                </div>
            </section>
            <!-- right col -->
        </div>


        <!------------------一行------------------------------------>

        <!--<div class="row docs-premium-template" style="margin-left: 3px;margin-right: 3px">
            <div class="col-sm-12 col-md-6">
                <div class="box box-solid">
                    <div class="box-body">
                        <h4 style="background-color:#f7f7f7; font-size: 18px; text-align: center; padding: 7px 10px; margin-top: 0;">
                            运营活动情况
                        </h4>
                        <div class="media">
                            <div class="media-left">
                                <a href="#" class="ad-click-event">
                                    <img src="/bootstrap/adminLTE/dists/img/background1.jpg" alt="Ample Admin"
                                         class="media-object"
                                         style="width: 150px;height: auto;border-radius: 4px;box-shadow: 0 1px 3px rgba(0,0,0,.15);">
                                </a>
                            </div>
                            <div class="media-body">
                                <div class="clearfix">
                                    <p class="pull-right">
                                        <a href="/actmanager/page"
                                           class="btn btn-primary btn-sm ad-click-event">
                                            GO活动管理
                                        </a>
                                    </p>

                                    <h5 style="margin-top: 15px;margin-left: 20px">总活动数 ─ <span th:text="${actCount.totalAct}"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;进行中活动
                                        ─ <span th:text="${actCount.onAct}"></span></h5>
                                    <h5 style="margin-top: 20px;margin-left: 20px">待发布活动 ─ <span th:text="${actCount.todoAct}"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;已结束活动
                                        ─ <span th:text="${actCount.overAct}"></span></h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-12 col-md-6">
                <div class="box box-solid">
                    <div class="box-body">
                        <h4 style="background-color:#f7f7f7; font-size: 18px; text-align: center; padding: 7px 10px; margin-top: 0;">
                            广告位投放情况
                        </h4>
                        <div class="media">
                            <div class="media-left">
                                <a href="#" class="ad-click-event">
                                    <img src="/bootstrap/adminLTE/dists/img/background2.jpg" alt="Appzia"
                                         class="media-object"
                                         style="width: 150px;height: auto;border-radius: 4px;box-shadow: 0 1px 3px rgba(0,0,0,.15);">
                                </a>
                            </div>
                            <div class="media-body">
                                <div class="clearfix">
                                    <p class="pull-right">
                                        <a href="/adplace/page"
                                           class="btn btn-primary btn-sm ad-click-event">
                                            GO广告位管理
                                        </a>
                                    </p>
                                   &lt;!&ndash; <h5 style="margin-top: 15px;margin-left: 20px">总广告位 ─ <span th:text="${adplaceData.total}"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;自有渠道广告位
                                        ─ <span th:text="${adplaceData.adplace}"></span></h5>
                                    <h5 style="margin-top: 20px;margin-left: 20px">外部广告位 ─ <span th:text="${adplaceData.channel}"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;进行活动广告位
                                        ─ <span th:text="${adplaceData.ad}"></span></h5>&ndash;&gt;
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>-->


        <!----------------------一行显示-------------------- -->

        <div class="row" style="margin-left: 3px;margin-right: 3px">

            <div class="col-md-12">
                <div class="box box-primary">
                    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
                    <div id="actSourceBar" style="height:450px"></div>
                </div>

                <!-- /.box -->

            </div>


        </div>


    </div>
</div>


<div th:include="common/simple_js :: simpleJS"></div>
<!-- FastClick -->
<script th:src="@{/bootstrap/adminLTE/bower_components/fastclick/lib/fastclick.js}"></script>
<!-- AdminLTE App -->
<script th:src="@{/bootstrap/adminLTE/dists/js/adminlte.min.js}"></script>

<script th:src="@{/bootstrap/echarts/distm/echarts.js}"></script>

<!--<script th:src="@{/bootstrap/js/date-time/bootstrap-datetimepicker.js}"></script>-->
<script th:src="@{/bootstrap/js/date-time/bootstrap-datepicker.js}"></script>

<script th:src="@{/bootstrap/js/fas/fas.dateFormat.js}"></script>

<script th:inline="javascript">

    var resourceXName = /*[[${resourceXName}]]*/'Sebastian';
    var resourceXData = /*[[${resourceXData}]]*/'Sebastian';
    var actXName = /*[[${actXName}]]*/'Sebastian';
    var actXData = /*[[${actXData}]]*/'Sebastian';

    $(function () {
        $('#cal').datepicker({
            'language': "zh-CN",
            'weekStart': 1,
            'format': 'yyyy-mm-dd ',
            'todayHighlight': true,
            'todayBtn': true,
            'showClear': true,
            'showClose': false,
            'inline': false

        }).on('changeDate', function (ev) {
            console.log(ev);
            var current = newDate(ev.date.valueOf()).Format("yyyy-MM-dd hh:mm:ss");
            console.log(current);
            initActs(ev.date.valueOf());
        });




    });


    //****初始化当日活动方法*********
    function initActs(current) {
        $.ajax({
            type: 'POST',
            url: '/actmanager/getallacts',
            data: {'current': current},
            dataType: 'json',
            success: function (mydata) {
                var data = mydata.data;
                //删除当前活动节点
                $(".currentact").remove();
                var currentActs = $('#currentacts');
                if (mydata.data.length > 0) {
                    //循环添加当前活动节点
                    for (var i = 0; i < data.length; i++) {
                        var currentact = $('<div class="col-sm-12 currentact"  >')
                        var actmsg = $('<div class="clearfix  "></div>');
                        $('<span class="pull-left">' + data[i].name + '(' + newDate(data[i].beginTime).Format("yyyy-MM-dd") + '至' + new Date(data[i].endTime).Format("yyyy-MM-dd") + ')' + '</span>').appendTo(actmsg);
                        $('<small class="pull-right">' + '进度' + data[i].percent + '%' + '</small>').appendTo(actmsg);
                        var percent = $('<div class="progress xs "></div>');
                        $('<div class="progress-bar  progress-bar-green " style="width: ' + data[i].percent + '%' + '"></div>').appendTo(percent);
                        actmsg.appendTo(currentact);
                        percent.appendTo(currentact);
                        currentact.appendTo(currentActs);
                    }
                    return;
                }
                var noact = $('<div class="col-sm-12 currentact"  >');
                $('<span class="pull-left" style="color: dodgerblue">今日暂无进行中活动！！！</span>').appendTo(noact);
                noact.appendTo(currentActs);
            },
        });
    }

    //*****************echarts表格*****************
    // 路径配置
    require.config({
        paths: {
            echarts: '/bootstrap/echarts/distm'
        }
    });

    // 使用
    require(
        [
            'echarts',
            'echarts/chart/line',
            'echarts/chart/bar'
        ],

        function (ec) {
            // 基于准备好的dom，初始化echarts图表
            var sourceBarChart = ec.init(document.getElementById('actSourceBar'));
            var actLineChart = ec.init(document.getElementById('actLine'));
            var resBarOption = {
                title: {
                    text: '活动资源使用明细统计',
                    subtext: '截止当日所有数据',
                    x: 'center',
                    textAlign: 'center'
                },
                //color: ['#bda29a', '#6e7074', '#546570', '#c4ccd3'],
                tooltip: {
                    trigger: 'item'
                },
                toolbox: {
                    show: true,
                    feature: {
                        mark: {show: true},
                        dataView: {show: true, readOnly: false},
                        magicType: {show: true, type: ['line', 'bar']},
                        restore: {show: true},
                        saveAsImage: {show: true}
                    }
                },
                calculable: true,
                legend: {
                    data: ['资源总量', '已使用', '剩余'],
                    x: 'left'
                },
                xAxis: [
                    {
                        type: 'category',
                        data: resourceXName
                    }
                ],
                yAxis: [
                    {
                        type: 'value'
                    }
                ],
                series: resourceXData
            };

            var actLineOption = {
                title: {
                    text: '活动参与明细统计',
                    subtext: '近一周数据',
                    x: 'center',
                    textAlign: 'center'
                },
                //color: [ '#bda29a', '#6e7074', '#546570', '#c4ccd3'],
                tooltip: {
                    trigger: 'item'
                },
                toolbox: {
                    show: true,
                    feature: {
                        mark: {show: true},
                        dataView: {show: true, readOnly: false},
                        magicType: {show: true, type: ['line', 'bar']},
                        restore: {show: true},
                        saveAsImage: {show: true}
                    }
                },
                calculable: true,
                legend: {
                    data: ['活动pv', '活动uv', '参与量', '留存量'],
                    x: 'left'
                },
                xAxis: [
                    {
                        type: 'category',
                        data: actXName
                    }
                ],
                yAxis: [
                    {
                        type: 'value'
                    }
                ],
                series: actXData
            };

            // 为echarts对象加载数据
            sourceBarChart.setOption(resBarOption);
            actLineChart.setOption(actLineOption);
        }
    );

    /*function jump(value) {

        var A = $("a [target='main_frame']");
        var target = null;
        for(var i=0;i<A.length;i++){
            if(value === A[i].attr("href")){
                target = A[i];
            }
        }

        //删除所有菜单项(li标签)的active属性
        $('.submenu > li').removeClass('active');

        var no_parent = target.parents('.nav-list li').length;
        if(no_parent){
            target.addClass('active'); //如果没有父菜单，则添加active open样式
        }else{
            target.addClass('active').parents('li').addClass('active');//如果有父菜单，则自身添加active样式，所有父菜单添加active open样式
        }

    }*/
</script>

</body>
</html>
